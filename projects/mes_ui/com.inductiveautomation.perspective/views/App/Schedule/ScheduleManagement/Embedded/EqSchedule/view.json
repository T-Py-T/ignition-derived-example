{
  "custom": {
    "Data": [
      {
        "DateCreated": {
          "$": [
            "ts",
            0,
            1700235445545
          ],
          "$ts": 1644253200000
        },
        "EnteredBy": "bduran",
        "ID": 1,
        "LineID": 11,
        "LineName": "201",
        "Note": "",
        "ProductCodeID": 2,
        "Quantity": 30000,
        "RequiredEndDate": {
          "$": [
            "ts",
            0,
            1700235445545
          ],
          "$ts": 1684814400000
        },
        "ScheduleEndDateTime": {
          "$": [
            "ts",
            0,
            1700235445545
          ],
          "$ts": 1685764800000
        },
        "ScheduleStartDateTime": {
          "$": [
            "ts",
            0,
            1700235445545
          ],
          "$ts": 1685592000000
        },
        "WorkOrder": "WO2023020718201768",
        "WorkOrderID": 1
      },
      {
        "DateCreated": {
          "$": [
            "ts",
            0,
            1700235445545
          ],
          "$ts": 1644253200000
        },
        "EnteredBy": "bduran",
        "ID": 2,
        "LineID": 12,
        "LineName": "202",
        "Note": "",
        "ProductCodeID": 1,
        "Quantity": 420001,
        "RequiredEndDate": {
          "$": [
            "ts",
            0,
            1700235445545
          ],
          "$ts": 1684749600000
        },
        "ScheduleEndDateTime": {
          "$": [
            "ts",
            0,
            1700235445545
          ],
          "$ts": 1685660400000
        },
        "ScheduleStartDateTime": {
          "$": [
            "ts",
            0,
            1700235445545
          ],
          "$ts": 1683327600000
        },
        "WorkOrder": "WO2023020718201354",
        "WorkOrderID": 2
      },
      {
        "DateCreated": {
          "$": [
            "ts",
            0,
            1700235445545
          ],
          "$ts": 1684529856143
        },
        "EnteredBy": "bduran",
        "ID": 5,
        "LineID": 20,
        "LineName": "LABSIM",
        "Note": "",
        "ProductCodeID": 3,
        "Quantity": 555,
        "RequiredEndDate": {
          "$": [
            "ts",
            0,
            1700235445545
          ],
          "$ts": 1684641600000
        },
        "ScheduleEndDateTime": {
          "$": [
            "ts",
            0,
            1700235445545
          ],
          "$ts": 1685678400000
        },
        "ScheduleStartDateTime": {
          "$": [
            "ts",
            0,
            1700235445545
          ],
          "$ts": 1685592000000
        },
        "WorkOrder": "test1234",
        "WorkOrderID": 5
      },
      {
        "DateCreated": {
          "$": [
            "ts",
            0,
            1700235445545
          ],
          "$ts": 1684534298090
        },
        "EnteredBy": "bduran",
        "ID": 6,
        "LineID": 1,
        "LineName": "SFN1",
        "Note": "",
        "ProductCodeID": 1,
        "Quantity": 654,
        "RequiredEndDate": {
          "$": [
            "ts",
            0,
            1700235445545
          ],
          "$ts": 1684728000000
        },
        "ScheduleEndDateTime": {
          "$": [
            "ts",
            0,
            1700235445545
          ],
          "$ts": 1684728000000
        },
        "ScheduleStartDateTime": {
          "$": [
            "ts",
            0,
            1700235445545
          ],
          "$ts": 1684555200000
        },
        "WorkOrder": "1234",
        "WorkOrderID": 31
      },
      {
        "DateCreated": {
          "$": [
            "ts",
            0,
            1700235445545
          ],
          "$ts": 1684534486750
        },
        "EnteredBy": "bduran",
        "ID": 7,
        "LineID": 3,
        "LineName": "SFN3",
        "Note": "test",
        "ProductCodeID": 2,
        "Quantity": 123,
        "RequiredEndDate": {
          "$": [
            "ts",
            0,
            1700235445545
          ],
          "$ts": 1684641600000
        },
        "ScheduleEndDateTime": {
          "$": [
            "ts",
            0,
            1700235445545
          ],
          "$ts": 1684814400000
        },
        "ScheduleStartDateTime": {
          "$": [
            "ts",
            0,
            1700235445545
          ],
          "$ts": 1684641600000
        },
        "WorkOrder": "7778",
        "WorkOrderID": 15
      }
    ],
    "SelectedScheduleData": [
      {
        "DateCreated": {
          "$": [
            "ts",
            0,
            1700235445546
          ],
          "$ts": 1644253200000
        },
        "EnteredBy": "bduran",
        "ID": 2,
        "LineID": 12,
        "LineName": "202",
        "Note": "",
        "ProductCodeID": 1,
        "Quantity": 420001,
        "RequiredEndDate": {
          "$": [
            "ts",
            0,
            1700235445545
          ],
          "$ts": 1684749600000
        },
        "ScheduleEndDateTime": {
          "$": [
            "ts",
            0,
            1700235445546
          ],
          "$ts": 1685660400000
        },
        "ScheduleStartDateTime": {
          "$": [
            "ts",
            0,
            1700235445546
          ],
          "$ts": 1683327600000
        },
        "WorkOrder": "WO2023020718201354",
        "WorkOrderID": 2
      }
    ],
    "SelectedScheduleID": 2
  },
  "params": {
    "EqScheduleEndDate": {
      "$": [
        "ts",
        0,
        1685847584135
      ],
      "$ts": 1686715200000
    },
    "EqScheduleStartDate": {
      "$": [
        "ts",
        0,
        1685847517546
      ],
      "$ts": 1682913600000
    },
    "ScheduleQueryDS": {
      "$": [
        "ds",
        192,
        1685904321569
      ],
      "$columns": [
        {
          "data": [
            1,
            2,
            5,
            6,
            7
          ],
          "name": "ID",
          "type": "Integer"
        },
        {
          "data": [
            11,
            12,
            20,
            1,
            3
          ],
          "name": "LineID",
          "type": "Integer"
        },
        {
          "data": [
            "201",
            "202",
            "LABSIM",
            "SFN1",
            "SFN3"
          ],
          "name": "LineName",
          "type": "String"
        },
        {
          "data": [
            1,
            2,
            5,
            31,
            15
          ],
          "name": "WorkOrderID",
          "type": "Integer"
        },
        {
          "data": [
            "WO2023020718201768",
            "WO2023020718201354",
            "test1234",
            "1234",
            "7778"
          ],
          "name": "WorkOrder",
          "type": "String"
        },
        {
          "data": [
            1684814400000,
            1684749600000,
            1684641600000,
            1684728000000,
            1684641600000
          ],
          "name": "RequiredEndDate",
          "type": "Date"
        },
        {
          "data": [
            2,
            1,
            3,
            1,
            2
          ],
          "name": "ProductCodeID",
          "type": "Integer"
        },
        {
          "data": [
            1685592000000,
            1683327600000,
            1685592000000,
            1684555200000,
            1684641600000
          ],
          "name": "ScheduleStartDateTime",
          "type": "Date"
        },
        {
          "data": [
            1685764800000,
            1685660400000,
            1685678400000,
            1684728000000,
            1684814400000
          ],
          "name": "ScheduleEndDateTime",
          "type": "Date"
        },
        {
          "data": [
            30000,
            420001,
            555,
            654,
            123
          ],
          "name": "Quantity",
          "type": "Integer"
        },
        {
          "data": [
            "bduran",
            "bduran",
            "bduran",
            "bduran",
            "bduran"
          ],
          "name": "EnteredBy",
          "type": "String"
        },
        {
          "data": [
            1644253200000,
            1644253200000,
            1684529856143,
            1684534298090,
            1684534486750
          ],
          "name": "DateCreated",
          "type": "Date"
        },
        {
          "data": [
            "",
            "",
            "",
            "",
            "test"
          ],
          "name": "Note",
          "type": "String"
        }
      ]
    }
  },
  "propConfig": {
    "custom.Data": {
      "binding": {
        "config": {
          "expression": "runScript(\u0027gpa.data.datasetToJson\u0027, 0, {view.params.ScheduleQueryDS})"
        },
        "type": "expr"
      },
      "persistent": true
    },
    "custom.SelectedScheduleData": {
      "binding": {
        "config": {
          "path": "view.custom.Data"
        },
        "transforms": [
          {
            "code": "\tdata \u003d []\n\teventID \u003d self.custom.SelectedScheduleID\n\t\n\tfor v in value:\t\n\t\tif v[\u0027ID\u0027] \u003d\u003d eventID: data.append(v)\n\t\t\n\treturn data",
            "type": "script"
          }
        ],
        "type": "property"
      },
      "persistent": true
    },
    "custom.SelectedScheduleID": {
      "binding": {
        "config": {
          "path": "/root/EquipmentSchedule.props.selectedEvent.eventId"
        },
        "type": "property"
      },
      "persistent": true
    },
    "params.EqScheduleEndDate": {
      "paramDirection": "input",
      "persistent": true
    },
    "params.EqScheduleStartDate": {
      "paramDirection": "input",
      "persistent": true
    },
    "params.ScheduleQueryDS": {
      "paramDirection": "input",
      "persistent": true
    }
  },
  "props": {
    "defaultSize": {
      "height": 390,
      "width": 1054
    }
  },
  "root": {
    "children": [
      {
        "events": {
          "component": {
            "onClickEvent": {
              "config": {
                "script": "\tself.view.refreshBinding(\u0027custom.SelectedScheduleData\u0027)\n\tmovedStartTime \u003d event.start\n\trowData \u003d self.view.custom.SelectedScheduleData\n\tmodalName \u003d \u0027editScheduleItem\u0027\n\trowData[0].ScheduleStartDateTime \u003d movedStartTime\n\tsystem.perspective.print(movedStartTime)\n\t\n\tmodalPath \u003d \"App/Schedule/ScheduleManagement/Embedded/Popups/EditScheduleItem\"\n\tparams \u003d { \u0027RowData\u0027: rowData, \u0027ModalName\u0027: modalName }\n\t\n\terrorParams \u003d {\n\t\t\"ModalName\": \"ErrorModal\",\n\t\t\"ErrorMessage\": \"Please select a row first!\"\n\t}\n\t\n\tif len(rowData) \u003e 0:\n\t\tsystem.perspective.openPopup(\n\t\t\tmodalName, \n\t\t\tmodalPath, \n\t\t\tparams, \n\t\t\ttitle\u003d\"Edit Schedule\", \n\t\t\tmodal\u003dTrue, \n\t\t\toverlayDismiss\u003dTrue)\n\telse:\n\t\tsystem.perspective.openPopup(\"ErrorModal\", \n\t\t\"GlobalComponents/Modals/ErrorModal\", \n\t\terrorParams)"
              },
              "scope": "G",
              "type": "script"
            },
            "onMoveEvent": {
              "config": {
                "script": "\timport time\n\t\n#\tutcOffset \u003d system.tag.readBlocking([\"[default]cron/_UTCToLocalOffset\"])[0].value\n#\tmovedStartTime \u003d system.date.addHours(system.date.parse(event.start,\"yyyy-MM-dd HH:mm:ss\"), abs(utcOffset))\n#\tmovedEndTime \u003d system.date.addHours(system.date.parse(event.end,\"yyyy-MM-dd HH:mm:ss\"), abs(utcOffset))\n\n\tlogger \u003d system.util.getLogger(\u0027EqScheduleOnMoveItem.Script\u0027)\n\t\n\ttry:\n\t\t\n\t    self.view.refreshBinding(\u0027custom.SelectedScheduleData\u0027)\n\t    time.sleep(1)\n\t    rowData \u003d self.view.custom.SelectedScheduleData\n\t\n\t    movedStartTime \u003d system.date.parse(event.start,\"yyyy-MM-dd HH:mm:ss\")\n\t    movedEndTime \u003d system.date.parse(event.end,\"yyyy-MM-dd HH:mm:ss\")\n\t\n\t    editQueryPath \u003d \"app/Schedule/editSchedule\"\n\t    editParams \u003d {\n\t        \"scheduleID\": rowData[0].ID,\n\t        \"lineID\": rowData[0].LineID,\n\t        \"quantity\": rowData[0].Quantity,\n\t        \"note\": rowData[0].Note,\n\t        \"workOrderID\": rowData[0].WorkOrderID,\n\t        \"enteredBy\": self.session.custom.UserName,\n\t        \"scheduleStartDateTime\": movedStartTime,\n\t        \"scheduleEndDateTime\": movedEndTime\n\t    }\n\t    \n\t\n\t    if len(rowData) \u003e 0:\n\t        system.db.runNamedQuery(editQueryPath, editParams)\n\t        system.perspective.sendMessage(\u0027scheduleRefresh\u0027)\n\t        self.view.refreshBinding(\u0027custom.SelectedScheduleData\u0027)\n\t    else:\n\t        errorParams \u003d {\n\t            \"ModalName\": \"ErrorModal\",\n\t            \"ErrorMessage\": \"Please select a row first!\"\n\t        }\n\t        system.perspective.openPopup(\"ErrorModal\", \n\t        \"GlobalComponents/Modals/ErrorModal\", \n\t        errorParams)\n\t\n\texcept Exception as e:\n\t    errorParams \u003d {\n\t        \"ModalName\": \"ErrorModal\",\n\t        \"ErrorMessage\": str(e),\n\t    }\n\t\n\t    system.perspective.openPopup(\"ErrorModal\", \"GlobalComponents/Modals/ErrorModal\", errorParams)\n\t    logger.warn(\u0027There was an error: \u0027 + str(e))"
              },
              "scope": "G",
              "type": "script"
            },
            "onResizeEvent": {
              "config": {
                "script": "\tlogger \u003d system.util.getLogger(\u0027EqScheduleOnResizeItem.Script\u0027)\n\tself.view.refreshBinding(\u0027custom.SelectedScheduleData\u0027)\n\trowData \u003d self.view.custom.SelectedScheduleData\n\t\n#\tutcOffset \u003d system.tag.readBlocking([\"[default]cron/_UTCToLocalOffset\"])[0].value\n#\tmovedStartTime \u003d system.date.addHours(system.date.parse(event.start,\"yyyy-MM-dd HH:mm:ss\"), abs(utcOffset))\n#\tmovedEndTime \u003d system.date.addHours(system.date.parse(event.end,\"yyyy-MM-dd HH:mm:ss\"), abs(utcOffset))\n\tmovedStartTime \u003d system.date.parse(event.start,\"yyyy-MM-dd HH:mm:ss\")\n\tmovedEndTime \u003d system.date.parse(event.end,\"yyyy-MM-dd HH:mm:ss\")\n\n\n\teditQueryPath \u003d \"app/Schedule/editSchedule\"\n\teditParams \u003d {\n\t\t\"scheduleID\": rowData[0].ID,\n\t\t\"lineID\": rowData[0].LineID,\n\t\t\"quantity\": rowData[0].Quantity,\n\t\t\"note\": rowData[0].Note,\n\t\t\"workOrderID\": rowData[0].WorkOrderID,\n\t\t\"enteredBy\": self.session.custom.UserName,\n\t\t\"scheduleStartDateTime\": movedStartTime,\n\t\t\"scheduleEndDateTime\": movedEndTime\n\t\t}\n\t\n\terrorParams \u003d {\n\t\t\"ModalName\": \"ErrorModal\",\n\t\t\"ErrorMessage\": \"Please select a row first!\"\n\t}\n\t\n\tsystem.perspective.print(editParams)\n\tif len(rowData) \u003e 0:\n\t\tsystem.db.runNamedQuery(editQueryPath, editParams)\n\t\tsystem.perspective.sendMessage(\u0027scheduleRefresh\u0027)\n\t\tself.view.refreshBinding(\u0027custom.SelectedScheduleData\u0027)\n\telse:\n\t\tsystem.perspective.openPopup(\"ErrorModal\", \n\t\t\"GlobalComponents/Modals/ErrorModal\", \n\t\terrorParams)\t"
              },
              "scope": "G",
              "type": "script"
            }
          }
        },
        "meta": {
          "contextMenu": {
            "items": [
              {
                "children": [],
                "icon": {
                  "color": "",
                  "path": "",
                  "style": {}
                },
                "link": {
                  "target": "self",
                  "url": ""
                },
                "message": {
                  "payload": {},
                  "scope": "page",
                  "type": ""
                },
                "method": {
                  "name": "",
                  "params": {}
                },
                "style": {
                  "classes": ""
                },
                "text": "menu-item",
                "type": "message"
              }
            ]
          },
          "name": "EquipmentSchedule",
          "tooltip": {
            "enabled": true,
            "text": "Click and Hold to drag an item or resize it!"
          }
        },
        "position": {
          "basis": "500px"
        },
        "propConfig": {
          "custom.ScheduleItems": {
            "binding": {
              "config": {
                "path": "view.params.ScheduleQueryDS"
              },
              "type": "property"
            }
          },
          "custom.items": {
            "binding": {
              "config": {
                "path": "this.custom.ScheduleItems"
              },
              "transforms": [
                {
                  "code": "\tpyDS \u003d system.dataset.toPyDataSet(value)\n\tlinesList, usedLineIDs \u003d [],[]\n\tfor row in pyDS:\n\t\tif row[\u0027LineID\u0027] not in usedLineIDs:\n\t\t\titemDict \u003d{}\n\t\t\titemDict[\u0027id\u0027] \u003d row[\u0027LineID\u0027]\n\t\t\titemDict[\u0027label\u0027] \u003d  row[\u0027LineName\u0027]\n\t\t\titemDict[\u0027rowStyle\u0027] \u003d {\"classes\": \"\"}\n\t\t\titemDict[\u0027headerStyle\u0027] \u003d {\"classes\": \"\"}\n\t\t\titemDict[\u0027iconConfig\u0027] \u003d{\"path\": \"\",\"color\": \"\", \"style\": {}}\n\t\t\t\n\t\t\tlinesList.append(itemDict)\n\t\t\tusedLineIDs.append(row[\u0027LineID\u0027])\n\treturn linesList",
                  "type": "script"
                }
              ],
              "type": "property"
            }
          },
          "custom.scheduleEvents": {
            "binding": {
              "config": {
                "path": "this.custom.ScheduleItems"
              },
              "transforms": [
                {
                  "code": "\tpyDS \u003d system.dataset.toPyDataSet(value)\n\tlinesList \u003d[]\n\tfor row in pyDS:\n\t\titemDict \u003d{}\n\t\titemDict[\u0027itemId\u0027] \u003d row[\u0027LineID\u0027]\n\t\titemDict[\u0027eventId\u0027] \u003d row[\u0027ID\u0027]\n\t\titemDict[\u0027label\u0027] \u003d \"WO - \" + row[\u0027WorkOrder\u0027]\n\t\titemDict[\u0027startDate\u0027] \u003d row[\u0027ScheduleStartDateTime\u0027]\n\t\titemDict[\u0027endDate\u0027] \u003d row[\u0027ScheduleEndDateTime\u0027]\n\t\t#itemDict[\u0027rowStyle\u0027] \u003d {\"classes\": \"\"}\n\t\t#itemDict[\u0027headerStyle\u0027] \u003d {\"classes\": \"\"}\n\t\t#itemDict[\u0027iconConfig\u0027] \u003d{\"path\": \"\",\"color\": \"\", \"style\": {}}\n\t\titemDict[\u0027percentDone\u0027] \u003d 0\n\t\titemDict[\u0027leadTime\u0027] \u003d 1\n\t\tlinesList.append(itemDict)\n\treturn linesList",
                  "type": "script"
                }
              ],
              "type": "property"
            }
          },
          "props.dateRange.endDate": {
            "binding": {
              "config": {
                "path": "view.params.EqScheduleEndDate"
              },
              "type": "property"
            }
          },
          "props.dateRange.startDate": {
            "binding": {
              "config": {
                "path": "view.params.EqScheduleStartDate"
              },
              "type": "property"
            }
          },
          "props.items": {
            "binding": {
              "config": {
                "path": "this.custom.items"
              },
              "type": "property"
            }
          },
          "props.scheduledEvents": {
            "binding": {
              "config": {
                "path": "this.custom.scheduleEvents"
              },
              "type": "property"
            }
          }
        },
        "props": {
          "addEnabled": false,
          "dateRange": {},
          "defaultZoom": "day",
          "deleteEnabled": false,
          "progressBar": {
            "enabled": false
          },
          "selectedEvent": {
            "eventId": 2,
            "itemId": 12
          }
        },
        "type": "ia.display.equipmentschedule"
      }
    ],
    "meta": {
      "name": "root"
    },
    "props": {
      "direction": "column"
    },
    "type": "ia.container.flex"
  }
}